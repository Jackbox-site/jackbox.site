(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{2822:function(t,e,n){t.exports='<header class="jbg-navbar">\n    <div class="container">\n        <img alt="jackbox.tv" class="jbg-top-logo img-responsive" src='+n(2823)+' />\n    </div>\n</header>\n\n<div class="connectScreen signin-container">\n    <div class="jbg_form_container">\n        <form class="jbg_form" autocomplete="off">\n            <fieldset>\n                <div class="form-group">\n                    <label for="roomCode" class="text-signin">КОД КОМНАТЫ</label>\n                    <input id="roomCode" name="roomCode" class="form-control jbg-input" type="text" placeholder="ВВЕДИТЕ 4-БУКВЕННЫЙ КОД" style="text-transform:uppercase;" maxlength="4" value="" autocapitalize="off" autocorrect="off" autocomplete="off">\n                </div>\n            </fieldset>\n            <fieldset>\n                <div class="form-group">\n                    <label for="password" class="text-signin">ПАРОЛЬ</label>\n                    <input id="password" name="password" class="form-control jbg-input" type="text" placeholder="ВВЕДИТЕ 5-ЗНАЧНЫЙ ПАРОЛЬ" style="text-transform:uppercase;" maxlength="5" value="" autocapitalize="off" autocorrect="off" autocomplete="off">\n                </div>\n            </fieldset>\n            <p class="signinWarning errorMessage"></p>\n            <div class="col-xs-12 text-center">\n                <button type="submit" id="connect" class="button-signin button-blue">\n                    <div class="play-text">МОДЕРИРОВАТЬ</div>\n                </button>\n            </div>\n        </form>\n    </div>\n</div>\n\n<div class="moderationScreen">\n    <div class="column">\n        <div class="allButtons">\n            <button id="acceptAll" class="approve">Подтвердить Всё</button>\n            <button id="rejectAll" class="reject">Отклонить всё</button>\n        </div>\n        <div id="entitiesRegion"></div>\n    </div>\n</div>\n\n'},2823:function(t,e,n){t.exports=n.p+"images/bac240289d5e1201c304f265851e0f01.svg"},2824:function(t,e,n){},2849:function(t,e,n){"use strict";n.r(e),n.d(e,"ModerationView",(function(){return S}));var o=n(17),s=n.n(o),i=n(22),a=n.n(i),r=n(41),c=n.n(r),l=n(31),h=n.n(l),u=n(47),d=n(484),p=n(35),v=n(3),m=n(2822),f=n.n(m);n(2824);function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function C(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach((function(e){b(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function b(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function y(t,e,n,o,s,i,a){try{var r=t[i](a),c=r.value}catch(t){return void n(t)}r.done?e(c):Promise.resolve(c).then(o,s)}function w(t){return function(){var e=this,n=arguments;return new Promise((function(o,s){var i=t.apply(e,n);function a(t){y(i,o,s,a,r,"next",t)}function r(t){y(i,o,s,a,r,"throw",t)}a(void 0)}))}}function M(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t))&&"[object Arguments]"!==Object.prototype.toString.call(t))return;var n=[],o=!0,s=!1,i=void 0;try{for(var a,r=t[Symbol.iterator]();!(o=(a=r.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var k=c.a.Model.extend({idAttribute:"key"}),T=h.a.View.extend({template:a.a.template('\n        <div class="empty">Ждём пока игроки выполнят задания...</div>\n        <div class="empty-icon">\n            <div></div>\n            <div></div>\n            <div></div>\n            <div></div>\n        </div>\n    ')}),x=h.a.View.extend({model:new k,template:a.a.template('\n<div class="content">\n    <p class="name"></p>\n    <p class="context"></p>\n    <p class="value"></p>\n    <button aria-label="accept" class="accept"></button>\n    <button aria-label="reject" class="reject"></button>\n</div>\n'),className:"entity text",triggers:{"click button.accept":"accept","click button.reject":"reject"},bindings:{":el":{classes:{rejected:{observe:"status",onGet:function(t){return"rejected"===t}},accepted:{observe:"status",onGet:function(t){return"accepted"===t}},disabled:{observe:"status",onGet:function(t){return["accepted","rejected"].includes(t)}}}},".value":"value",".name":"name",".context":{observe:"context",updateMethod:"html",onGet:function(t){if(!t)return null;var e="";return t.html&&(e+=t.html),t.text&&(e+=s()("<div />").text(t[0]).html()),e}},".actions .button":{attributes:[{name:"disabled",observe:"status",onGet:function(t){return["accepted","rejected"].includes(t)}}]}},onAttach:function(){this.stickit()}}),X=x.extend({className:"entity drawing",bindings:a.a.extend({},x.prototype.bindings,{".value":{observe:"value",updateMethod:"html",onGet:function(t){if(!t)return null;Array.isArray(t)&&(t={lines:t,size:{width:640,height:640},sketchOptions:{controlVectorConstant:.33,dotMultiplier:1,minThickness:2,smoothingFactor:.9,thicknessFactor:0,thicknessSmoothingFactor:.5,tipTaperFactor:1}});var e=t,n=e.src,o=e.lines,s=e.size,i=e.sketchOptions,a=s||{},r=a.width,l=a.height,h=new d.a({model:new c.a.Model({})});return h.render(),h.model.set({src:n,lines:o,size:s,options:i,width:r,height:l}),h.$el.html()}}})}),S=h.a.View.extend({template:a.a.template(f.a),model:new c.a.Model({roomCode:"",password:"",connection:"disconnected",codeStatus:"none",errorMessage:""}),className:"moderationView",regions:{entities:"#entitiesRegion"},events:{"click #connect":"onConnectClick","click #acceptAll":"onAcceptAllClick","click #rejectAll":"onRejectAllClick","click #disconnect":"onDisconnectClick"},triggers:{"childview:childview:moderate":"onModerateClick"},bindings:{"#roomCode":{observe:"code",onSet:function(t){return this.onRoomCodeChange(t),t}},"#password":{observe:"password",onSet:function(t){return this.onPasswordChange(t),t}},".input":{classes:{loading:{observe:"connection",onGet:function(t){return"connecting"===t}},disabled:{observe:"connection",onGet:function(t){return"disconnected"!==t}}}},"#connect":{classes:{ready:{observe:["codeStatus","password"],onGet:function(t){var e=M(t,2),n=e[0],o=e[1];return"valid"===n&&o&&5===o.length}},disabled:{observe:["codeStatus","password"],onGet:function(t){var e=M(t,2),n=e[0],o=e[1];return"valid"!==n||!o||5!==o.length}}}},".errorMessage":{observe:"errorMessage",visible:!0,updateView:!0},".connectScreen":{observe:"connection",visible:function(t){return"disconnected"===t||"connecting"===t}},".moderationScreen":{observe:"connection",visible:function(t){return"connected"===t}},".allButtons":{classes:{disabled:{observe:"pendingCount",onGet:function(t){return!t}}}}},initialize:function(t){this.entityCollectionView=new h.a.CollectionView({emptyView:T,childView:function(t){return"drawing"===t.get("type")||"photo"===t.get("type")?X:x},className:"entities",collection:new c.a.Collection([])});var e=u.a.queryParam("s")||v.a.EcastHost;this.api=new p.APIClient({host:e,scheme:"https"})},onRender:function(){this.showChildView("entities",this.entityCollectionView)},onAttach:function(){this.stickit()},onRoomCodeChange:function(t){var e=this;return w(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.model.set({codeStatus:"none",errorMessage:""}),4===t.length){n.next=3;break}return n.abrupt("return");case 3:return e.model.set({codeStatus:"pending"}),n.prev=4,n.next=7,e.api.getRoom({code:t});case 7:o=n.sent,e.model.set({codeStatus:o.moderationEnabled?"valid":"nomoderation"}),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(4),e.model.set({codeStatus:"error",connection:"disconnected"});case 14:case"end":return n.stop()}}),n,null,[[4,11]])})))()},onPasswordChange:function(t){this.model.set({errorMessage:""})},onConnectClick:function(t){var e=this;return w(regeneratorRuntime.mark((function n(){var o,s,i,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.preventDefault(),o=u.a.queryParam("s")||v.a.EcastHost,s=e.model.get("code")||"",i=e.model.get("password"),s&&i&&o){n.next=6;break}return n.abrupt("return");case 6:return n.prev=6,e.moderator=new p.WSClient({host:o,code:s.toUpperCase(),password:i,name:"moderator",role:"moderator",debug:v.a.debug}),e.moderator.on("object",e.onModeratorObject.bind(e)),e.moderator.on("socketClose",e.onModeratorSocketClose.bind(e)),e.moderator.on("room/exit",e.onModeratorSocketClose.bind(e)),e.moderator.on("drop",e.onModeratorDrop.bind(e)),e.model.set({connection:"connecting"}),n.next=15,e.moderator.connect();case 15:a=n.sent,e.onModeratorWelcome(a),n.next=23;break;case 19:n.prev=19,n.t0=n.catch(6),console.log("[ModerationView] Error connecting",n.t0),e.model.set({connection:"disconnected",errorMessage:"Unable to connect. Please check your room code and password."});case 23:return n.abrupt("return",!1);case 24:case"end":return n.stop()}}),n,null,[[6,19]])})))()},disconnect:function(){this.moderator&&(this.moderator.disconnect(),this.moderator=null),this.model.set({roomCode:"",password:"",connection:"disconnected"}),this.entityCollectionView.collection.reset()},onModeratorWelcome:function(t){var e=this;this.model.set({connection:"connected"}),this.entityCollectionView.collection.reset();var n=t.entities;Object.keys(n).forEach((function(t){var o=n[t];o.key&&-1!==o.key.indexOf("moderate:")&&e.onModeratorObject(o)}))},onModeratorObject:function(t){var e=t.key,n=t.val,o=M(e.split(":"),2),s=o[0],i=o[1];if("moderate"===s){var a=this.entityCollectionView.collection.get(e);a?a.set(C({},n)):this.entityCollectionView.collection.add(C({id:e,key:e,type:i},n))}var r=this.entityCollectionView.collection.where({status:"pending"});this.model.set({pendingCount:r.length})},onModeratorDrop:function(t){var e=t.key;this.entityCollectionView.collection.remove(e)},onModeratorSocketClose:function(){this.disconnect()},onAcceptAllClick:function(t){t.preventDefault();var e=[];return this.entityCollectionView.children.forEach((function(t){var n=t.model.get("key");"pending"===t.model.get("status")&&e.push(n)})),this.updateEntityStatus(e,"accepted"),!1},onRejectAllClick:function(t){t.preventDefault();var e=[];return this.entityCollectionView.children.forEach((function(t){var n=t.model.get("key");"pending"===t.model.get("status")&&e.push(n)})),this.updateEntityStatus(e,"rejected"),!1},onDisconnectClick:function(t){return t.preventDefault(),this.disconnect(),!1},onChildviewChildviewAccept:function(t){var e=this;return w(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=t.model.get("key"),e.updateEntityStatus(o,"accepted");case 2:case"end":return n.stop()}}),n)})))()},onChildviewChildviewReject:function(t){var e=this;return w(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=t.model.get("key"),e.updateEntityStatus(o,"rejected");case 2:case"end":return n.stop()}}),n)})))()},updateEntityStatus:function(t,e){var n=this;return w(regeneratorRuntime.mark((function o(){var s;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:s=t instanceof Array?t:[t],n.moderator.mail(1,{id:s,status:e}),s.forEach(function(){var t=w(regeneratorRuntime.mark((function t(o){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(s=n.moderator.entities[o].val).status=e,t.prev=2,t.next=5,n.moderator.updateObject(o,s);case 5:n.onModeratorObject(n.moderator.entities[o]),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),console.log("[ModerationView] failed to update object",t.t0);case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return o.stop()}}),o)})))()}})},484:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var o=n(22),s=n.n(o),i=n(41),a=n.n(i),r=n(31),c=n.n(r),l=(n(192),n(488)),h=c.a.View.extend({model:new a.a.Model({}),template:s.a.template("\n        <h1 class='title'>ImageView</h1>\n        <img class='imageData'>\n    "),bindings:{".title":{observe:"title",visible:!0,updateView:!0},".imageData":{attributes:[{name:"src",observe:["src","width","height","lines","options"],onGet:function(t){return t[0]?t[0]:this.setImageFromLines()}}]}},setImageFromLines:function(){var t=this.model.get("width")||640,e=this.model.get("height")||640,n=this.model.get("options"),o=this.model.get("lines")||[];if(!o.length||!n)return"";var s=new l.a(t,e,n);return s.setLines(o),s.canvas.toDataURL("image/png")},onRender:function(){this.stickit()}})},488:function(t,e,n){"use strict";function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return i}));var i=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,"options",void 0),s(this,"canvas",void 0),s(this,"canvasCTX",void 0),s(this,"tipCanvas",void 0),s(this,"tipCanvasCTX",void 0),s(this,"lines",[]),s(this,"image",void 0),s(this,"startX",null),s(this,"startY",null),s(this,"smoothedMouseX",null),s(this,"smoothedMouseY",null),s(this,"lastMouse",{}),s(this,"lastMouseChangeVector",{}),s(this,"lastSmoothedMouse",{}),s(this,"lastThickness",void 0),s(this,"lastRotation",void 0),s(this,"colorLevel",void 0),this.options=o,this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=n,this.canvasCTX=this.canvas.getContext("2d"),this.tipCanvas=document.createElement("canvas"),this.tipCanvas.width=e,this.tipCanvas.height=n,this.tipCanvasCTX=this.tipCanvas.getContext("2d")}var e,n,i;return e=t,(n=[{key:"addLine",value:function(t,e,n,o){this.lines.push({thickness:t,color:e,highlighter:n,points:[]}),this.addPoint(o),this.update()}},{key:"updateSize",value:function(t,e){this.canvas.width=t,this.canvas.height=e}},{key:"addPoint",value:function(t){var e={x:parseInt(t.x,10),y:parseInt(t.y,10)},n=this.lines[this.lines.length-1];if(n&&n.points){if(0!==n.points.length){var o=n.points[n.points.length-1];if(o.x===e.x&&o.y===e.y)return}n.points.push(e),this.update()}}},{key:"setLines",value:function(t){var e=t.map((function(t){var e=t.points;return e="string"==typeof e?t.points.split("|").map((function(t){return{x:parseInt(t.split(",")[0],10),y:parseInt(t.split(",")[1],10)}})):e.map((function(t){return{x:parseInt(t.x,10),y:parseInt(t.y,10)}})),{color:t.color,thickness:t.thickness,points:e}}));this.lines=e,this.update()}},{key:"setImage",value:function(t){this.image=t,this.update()}},{key:"reset",value:function(){this.lines=[],this.image=null,this.update()}},{key:"getLastLine",value:function(){var t=this.lines[this.lines.length-1];return{thickness:t.thickness,color:t.color,points:t.points.map((function(t){return"".concat(t.x,",").concat(t.y)})).join("|")}}},{key:"getLines",value:function(){return this.lines.map((function(t){return{thickness:t.thickness,color:t.color,points:t.points.map((function(t){return"".concat(t.x,",").concat(t.y)})).join("|")}}))}},{key:"update",value:function(){var t=this;this.canvasCTX&&this.canvasCTX.clearRect(0,0,this.canvas.width,this.canvas.height),this.tipCanvasCTX&&this.tipCanvasCTX.clearRect(0,0,this.canvas.width,this.canvas.height),this.image&&this.canvasCTX.drawImage(this.image,0,0),this.lines&&this.lines.forEach((function(e){return t.drawLine(e)}))}},{key:"startLineInContext",value:function(t,e,n){var o=t*this.options.minThickness;this.tipCanvasCTX.beginPath(),this.tipCanvasCTX.arc(e,n,o*this.options.dotMultiplier,0,2*Math.PI,!0),this.tipCanvasCTX.closePath(),this.tipCanvasCTX.fill(),this.tipCanvasCTX.stroke(),this.options.cappedEnds&&this.canvasCTX.drawImage(this.tipCanvasCTX.canvas,0,0),this.lastMouseChangeVector={x:0,y:0},this.startX=e,this.lastMouse.x=e,this.smoothedMouseX=e,this.lastSmoothedMouse.x=e,this.startY=n,this.lastMouse.y=n,this.smoothedMouseY=n,this.lastSmoothedMouse.y=n,this.lastThickness=o,this.lastRotation=void 0,this.colorLevel=0}},{key:"continueLineInContext",value:function(t,e,n){var o=e-this.lastMouse.x,s=n-this.lastMouse.y;o*this.lastMouseChangeVector.x+s*this.lastMouseChangeVector.y<0&&(this.tipCanvasCTX&&this.canvasCTX.drawImage(this.tipCanvasCTX.canvas,0,0),this.smoothedMouseX=this.lastMouse.x,this.lastSmoothedMouse.x=this.lastMouse.x,this.smoothedMouseY=this.lastMouse.y,this.lastSmoothedMouse.y=this.lastMouse.y,this.lastRotation+=Math.PI,this.lastThickness*=this.options.tipTaperFactor),this.smoothedMouseX+=this.options.smoothingFactor*(e-this.smoothedMouseX),this.smoothedMouseY+=this.options.smoothingFactor*(n-this.smoothedMouseY);var i,a=this.smoothedMouseX-this.lastSmoothedMouse.x,r=this.smoothedMouseY-this.lastSmoothedMouse.y,c=Math.sqrt(a*a+r*r);i=0!==c?Math.PI/2+Math.atan2(r,a):0;var l=this.options.minThickness*t+this.options.thicknessFactor*c,h=this.lastThickness+this.options.thicknessSmoothingFactor*(l-this.lastThickness);void 0===this.lastRotation&&(this.lastRotation=i);var u=null!==this.lastRotation?Math.sin(this.lastRotation):Math.sin(i),d=null!==this.lastRotation?Math.cos(this.lastRotation):Math.sin(i),p=Math.sin(i),v=Math.cos(i),m=this.lastThickness*u,f=this.lastThickness*d,g=h*p,C=h*v,b=.33*c*u,y=-.33*c*d,w=this.lastSmoothedMouse.x+f+b,M=this.lastSmoothedMouse.y+m+y,k=this.lastSmoothedMouse.x-f+b,T=this.lastSmoothedMouse.y-m+y;this.canvasCTX.beginPath(),this.canvasCTX.moveTo(this.lastSmoothedMouse.x+f,this.lastSmoothedMouse.y+m),this.canvasCTX.quadraticCurveTo(w,M,this.smoothedMouseX+C,this.smoothedMouseY+g),this.canvasCTX.lineTo(this.smoothedMouseX-C,this.smoothedMouseY-g),this.canvasCTX.quadraticCurveTo(k,T,this.lastSmoothedMouse.x-f,this.lastSmoothedMouse.y-m),this.canvasCTX.closePath(),this.canvasCTX.fill(),this.canvasCTX.stroke();var x=this.options.tipTaperFactor*h;this.tipCanvasCTX.clearRect(0,0,this.tipCanvasCTX.canvas.width,this.tipCanvasCTX.canvas.height),this.tipCanvasCTX.beginPath(),this.tipCanvasCTX.arc(e,n,x,0,2*Math.PI,!0),this.tipCanvasCTX.closePath(),this.tipCanvasCTX.fill(),this.tipCanvasCTX.stroke(),this.tipCanvasCTX.beginPath(),this.tipCanvasCTX.moveTo(this.smoothedMouseX+C,this.smoothedMouseY+g),this.tipCanvasCTX.lineTo(e+this.options.tipTaperFactor*C,n+this.options.tipTaperFactor*g),this.tipCanvasCTX.lineTo(e-this.options.tipTaperFactor*C,n-this.options.tipTaperFactor*g),this.tipCanvasCTX.lineTo(this.smoothedMouseX-C,this.smoothedMouseY-g),this.tipCanvasCTX.closePath(),this.tipCanvasCTX.fill(),this.tipCanvasCTX.stroke(),this.lastSmoothedMouse={x:this.smoothedMouseX,y:this.smoothedMouseY},this.lastRotation=i,this.lastThickness=h,this.lastMouseChangeVector={x:o,y:s},this.lastMouse={x:e,y:n}}},{key:"drawLine",value:function(t){if(t&&t.color&&t.points&&t.thickness&&this.canvasCTX&&this.tipCanvasCTX){this.canvasCTX.strokeStyle=t.color,this.canvasCTX.lineWidth=this.options.borderWidth,this.canvasCTX.lineCap="round",this.canvasCTX.lineJoin="bevel",this.canvasCTX.fillStyle=t.color,this.canvasCTX.strokeStyle=t.color,this.tipCanvasCTX.lineWidth=this.options.borderWidth,this.tipCanvasCTX.fillStyle=t.color,this.tipCanvasCTX.strokeStyle=t.color;for(var e=0;e<t.points.length;e++){var n=t.points[e];0===e&&this.startLineInContext(t.thickness,n.x,n.y),this.continueLineInContext(t.thickness,n.x,n.y)}this.canvasCTX.drawImage(this.tipCanvas,0,0)}}}])&&o(e.prototype,n),i&&o(e,i),t}()}}]);
//# sourceMappingURL=31.efe9ab0f0d9e7cbbafb6.js.map